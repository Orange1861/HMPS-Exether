# Vicky and the Expedition Machine
ai_expedition_simulator_start = {
	random_character_in_void = {
		limit = {
			exists = owner
			owner = root
			has_variable = is_retainer
		}
		set_variable = expedition_leader_var
		set_character_busy_and_immortal = yes
	}
	set_variable = on_expedition
	add_modifier = {
		name = modifier_large_expedition_cost
		multiplier = money_amount_multiplier_medium
		days = 365
	}
	trigger_event = { id = ai_expedition_simulator.1 days = 365 }
}

ai_expedition_simulator_end = {
	remove_variable = on_expedition
	remove_modifier = modifier_large_expedition_cost
	remove_modifier = expedition_extra_expenses_modifier
	remove_variable = AI_EXPEDITION_EVERFROST
	remove_variable = AI_EXPEDITION_DREAMWEAVER_JUNGLE
	remove_variable = AI_EXPEDITION_RIMEROOT
	remove_variable = AI_EXPEDITION_MINDREND
	remove_expedition_events_effect = yes
	exether_remove_expedition_effect = yes
	random_character_in_void = {
		limit = {
			exists = owner
			owner = root
			has_variable = expedition_leader_var
		}
		remove_variable = expedition_leader_var
	}
}

adopt_random_antigovernment_ideology = { # I'm so sorry for this.
	custom_tooltip = {
		text = adopt_random_antigovernment_ideology_tt
		random_list = { 
			50 = {
				trigger = {
					ideology_social_democrat_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = socialism
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_social_democrat	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_council_republic
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_social_democrat
			}
			100 = {
				trigger = {
					ideology_communist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = socialism
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_communist	
							}
						}
						NOT = {
							has_law = law_type:law_council_republic
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_trade_unions
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_integralist
									has_ideology = ideology:ideology_ethno_nationalist
									has_ideology = ideology:ideology_matriarchal_traditionalist
									has_ideology = ideology:ideology_traditionalist
									has_ideology = ideology:ideology_ecumenical_traditionalist
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_communist
			}
			100 = {
				trigger = {
					ideology_vanguardist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = political_agitation
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_vanguardist	
							}
						}
						NOT = {
							has_law = law_type:law_council_republic
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_trade_unions
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_integralist
									has_ideology = ideology:ideology_ethno_nationalist
									has_ideology = ideology:ideology_matriarchal_traditionalist
                					has_ideology = ideology:ideology_traditionalist
                					has_ideology = ideology:ideology_ecumenical_traditionalist
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_vanguardist
			}
			100 = {
				trigger = {
					ideology_anarchist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = anarchism
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_anarchist	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 50
					}
					if = {
						limit = {
							this.interest_group = {
								OR = {
									is_interest_group_type = ig_trade_unions
									is_interest_group_type = ig_rural_folk
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_integralist
									has_ideology = ideology:ideology_ethno_nationalist
									has_ideology = ideology:ideology_matriarchal_traditionalist
									has_ideology = ideology:ideology_traditionalist
									has_ideology = ideology:ideology_ecumenical_traditionalist
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_anarchist
			}
			100 = {
				trigger = {
					ideology_ethno_nationalist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = political_agitation
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_ethno_nationalist	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_radical
									has_ideology = ideology:ideology_feminist
									has_ideology = ideology:ideology_humanitarian
									has_ideology = ideology:ideology_humanitarian_royalist
									has_ideology = ideology:ideology_social_democrat
								}
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_communist
									has_ideology = ideology:ideology_anarchist
									has_ideology = ideology:ideology_vanguardist
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_integralist
									has_ideology = ideology:ideology_ethno_nationalist
									has_ideology = ideology:ideology_matriarchal_traditionalist
                					has_ideology = ideology:ideology_traditionalist
                					has_ideology = ideology:ideology_ecumenical_traditionalist
								}
							}
						}
						multiply = {
							value = 0.25
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_no_migration_controls
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_multicultural
							}
						}
						multiply = {
							value = 3
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_cultural_exclusion
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_council_republic
							}
						}
						multiply = {
							value = 1.5
						}
					}
				}
				set_ideology = ideology:ideology_ethno_nationalist
			}
			50 = {
				trigger = {
					ideology_nihilist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = realism
						has_law = law_type:law_state_religion
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_nihilist	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_state_religion
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_theocracy
							}
						}
						add = 200
					}
				}
				set_ideology = ideology:ideology_nihilist
			}
			50 = {
				trigger = {
					ideology_radical_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = egalitarianism
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_radical	
							}
						}
					}
				}
				modifier = {	
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 100
					}	
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_autocracy
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_oligarchy
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_landed_voting
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_radical
			}
			100 = {
				trigger = {
					ideology_fascist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = mass_propaganda
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_fascist	
								has_ideology = ideology:ideology_integralist
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_radical
									has_ideology = ideology:ideology_feminist
									has_ideology = ideology:ideology_humanitarian
									has_ideology = ideology:ideology_humanitarian_royalist
									has_ideology = ideology:ideology_social_democrat
								}
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_communist
									has_ideology = ideology:ideology_anarchist
									has_ideology = ideology:ideology_vanguardist
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_integralist
									has_ideology = ideology:ideology_ethno_nationalist
									has_ideology = ideology:ideology_matriarchal_traditionalist
                					has_ideology = ideology:ideology_traditionalist
                					has_ideology = ideology:ideology_ecumenical_traditionalist
								}
							}
						}
						multiply = {
							value = 0.25
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_council_republic
							}
						}
						multiply = {
							value = 2
						}
					}
				}
				set_ideology = ideology:ideology_fascist
			}
			50 = {
				trigger = {
					ideology_market_liberal_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = stock_exchange
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_market_liberal	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_command_economy
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_traditionalism
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_isolationism
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_communist
									has_ideology = ideology:ideology_anarchist
									has_ideology = ideology:ideology_vanguardist
								}
							}
						}
						add = 100
					}
				}
				set_ideology = ideology:ideology_market_liberal
			}
			50 = {
				trigger = {
					ideology_luddite_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = romanticism
						OR = {
							has_law = law_type:law_command_economy
							has_law = law_type:law_laissez_faire
							has_law = law_type:law_interventionism
						}
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_luddite	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								any_scope_state = {
									any_scope_building = {
										is_building_group = bg_heavy_industry
										level >= 5
									}
									state_unemployment_rate > 0.1
								}
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								any_scope_building = {
									is_building_group = bg_heavy_industry
									level >= 5
								}
							}
						}
						add = 25
					}
					if = {
						limit = {
							OR = {
								is_interest_group_type = ig_rural_folk
								is_interest_group_type = ig_devout
							}
						}
						add = 50
					}
					if = {
						limit = {
							NOR = {
								is_interest_group_type = ig_rural_folk
								is_interest_group_type = ig_devout
							}
						}
						add = -50
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_ruling_interest_group = ig_industrialists
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_ruling_interest_group = ig_rural_folk
							}
						}
						multiply = {
							value = 0.25
						}
					}
				}
				set_ideology = ideology:ideology_luddite
			}
			50 = {
				trigger = {
					ideology_feminist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = feminism
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_feminist	
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_feminist
			}
			50 = {
				trigger = {
					ideology_humanitarian_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = feminism
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_humanitarian	
									has_ideology = ideology:ideology_humanitarian_royalist
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_humanitarian
			}

			50 = {
				trigger = {
					ideology_traditionalist_valid_trigger = yes
					NOT = {	
						scope:exiling_country_scope.ruler ?= {
							OR = {
								has_ideology = ideology:ideology_matriarchal_traditionalist
                				has_ideology = ideology:ideology_traditionalist
                				has_ideology = ideology:ideology_ecumenical_traditionalist
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							this.interest_group ?= {
								OR = {
									is_interest_group_type = ig_landowners
									is_interest_group_type = ig_devout
								}
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_radical
									has_ideology = ideology:ideology_feminist
									has_ideology = ideology:ideology_humanitarian	
									has_ideology = ideology:ideology_humanitarian_royalist
									has_ideology = ideology:ideology_social_democrat
								}
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_communist
									has_ideology = ideology:ideology_anarchist
									has_ideology = ideology:ideology_vanguardist
								}
							}
						}
						add = 100
					}
					if = {
						limit = {
							scope:exiling_country_scope.ruler ?= {
								OR = {
									has_ideology = ideology:ideology_fascist
									has_ideology = ideology:ideology_integralist
									has_ideology = ideology:ideology_ethno_nationalist
									has_ideology = ideology:ideology_matriarchal_traditionalist
                					has_ideology = ideology:ideology_traditionalist
                					has_ideology = ideology:ideology_ecumenical_traditionalist
								}
							}
						}
						multiply = {
							value = 0.25
						}
					}
					if = {
						limit = {
							this.interest_group ?= {
								OR = {
									is_interest_group_type = ig_intelligentsia
									is_interest_group_type = ig_industrialists
									is_interest_group_type = ig_trade_unions
								}
							}
						}
						multiply = {
							value = 0.2
						}
					}
				}
				if = {
					limit = {
						scope:exiling_country_scope.religion = {
							has_discrimination_trait = uriks_pantheon
						}
					}
					set_ideology = ideology:ideology_ecumenical_traditionalist
				}
				else = {
					set_ideology = ideology:ideology_traditionalist
				}
			}

			50 = {
				trigger = {
					ideology_republican_leader_valid_trigger = yes
					NOT = {	
						scope:exiling_country_scope.ruler ?= {
							has_ideology = ideology:ideology_republican_leader	
						}
					}
					scope:exiling_country_scope ?= {
						has_law = law_type:law_monarchy
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_autocracy
							}
						}
						multiply = {
							value = 2
						}
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_oligarchy
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_landed_voting
							}
						}
						add = 25
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_landowners
							}
						}
						multiply = {
							value = 0.10
						}
					}
				}
				set_ideology = ideology:ideology_republican_leader
			}

			50 = {
				trigger = {
					ideology_abolitionist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						NOT = {
							ruler = {
								has_ideology = ideology:ideology_abolitionist	
							}
						}
						OR = {
							has_law = law_type:law_serfdom
							NOT = {
								has_law = law_type:law_slavery_banned
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_serfdom
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								NOT = {
									has_law = law_type:law_slavery_banned
								}
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_slave_trade
							}
						}
						add = 50
					}
					if = {
						limit = {
							this.interest_group = {
								is_interest_group_type = ig_landowners
							}
						}
						multiply = {
							value = 0.05
						}
					}
				}
				set_ideology = ideology:ideology_abolitionist
			}

			50 = {
				trigger = {
					ideology_positivist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						NOR = {
							ruler = {
								has_ideology = ideology:ideology_positivist	
							}
							has_law = law_type:law_technocracy
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								country_has_voting_franchise = yes
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_state_religion
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_positivist
			}
			50 = {
				trigger = {
					ideology_humanitarian_royalist_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = feminism
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_humanitarian	
									has_ideology = ideology:ideology_humanitarian_royalist
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_monarchy
							}
						}
						add = 25
					}
				}
				set_ideology = ideology:ideology_humanitarian_royalist
			}
			50 = {
				trigger = {
					ideology_corporatist_leader_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = corporatism
						NOR = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_corporatist_leader
								}
							}
							has_law = law_type:law_corporate_state
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_council_republic
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_corporatist_leader
			}
			50 = {
				trigger = {
					ideology_liberal_leader_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = democracy
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_liberal_leader
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								country_has_voting_franchise = no
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_liberal_leader
			}
			50 = {
				trigger = {
					ideology_land_reformer_valid_trigger = yes
					scope:exiling_country_scope ?= {
						has_technology_researched = enclosure
						NOT = {
							ruler = {
								OR = {
									has_ideology = ideology:ideology_land_reformer
								}
							}
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_serfdom
							}
						}
						add = 50
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_tenant_farmers
							}
						}
						add = 25
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								has_law = law_type:law_land_based_taxation
							}
						}
						add = 50
					}
				}
				set_ideology = ideology:ideology_land_reformer
			}
			50 = {
				trigger = {
					ideology_utilitarian_leader_valid_trigger = yes # Give me your organs.
					culture = {
						has_discrimination_trait = imperial_culture_group
					}
					scope:exiling_country_scope ?= {
						has_technology_researched = empiricism
						any_primary_culture = {
							has_discrimination_trait = imperial_culture_group
						}
					}
				}
				modifier = {
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								NOT = {
									has_law = law_type:law_compulsory_primary_school
								}
							}
						}
						add = 10
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								NOT = {
									has_law = law_type:law_public_schools
								}
							}
						}
						add = 10
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								NOT = {
									has_law = law_type:law_womens_suffrage
								}
							}
						}
						add = 10
					}
					if = {
						limit = {
							scope:exiling_country_scope ?= {
								NOR = {
									has_law = law_type:law_graduated_taxation
									has_law = law_type:law_proportional_taxation
								}
							}
						}
						add = 10
					}
				}
				set_ideology = ideology:ideology_utilitarian_leader
			}
			1 = { # Fallback
				set_ideology = ideology:ideology_jingoist_leader
			}
		}
	}
}

save_agitator_election_scopes = {
	if = {
		limit = {
			has_variable = preset_ideology
		}
		scope:agitator_scope = {
			this.interest_group = {
				save_scope_as = agitator_ig_scope
			}
		}
	}
	else = {
		random_scope_character = {
			limit = {
				has_role = agitator
				NOT = {
					has_variable = agitator_election_participation
				}
			}
			save_scope_as = agitator_scope
			this.interest_group = {
				save_scope_as = agitator_ig_scope
			}
		}
	}

	#Attach to party

	if = {
		limit = {
			any_political_movement = {
				any_supporting_character = {
					this = scope:agitator_scope
				}
			}
		} 
		random_political_movement = {
			limit = {
				any_supporting_character = {
					this = scope:agitator_scope
				}	
			}
			save_scope_as = agitator_movement_scope
		}
	}
	if = {
		limit = {
			scope:agitator_scope.interest_group = {
				has_party = yes
			}
		}
		scope:agitator_scope.interest_group.party = {
			save_scope_as = agitator_party_scope
		}
	}
	else = {
		if = {
			limit = {
				scope:agitator_scope = {
					has_socialist_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_socialist_ideology = yes
						}
					}	
				}
			}	
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_socialist_ideology = yes
						}	
					}
				}
				save_scope_as = agitator_party_scope	
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_progressive_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_progressive_ideology = yes
						}
					}
				}
			}	
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_progressive_ideology = yes
						}	
					}
				}
				save_scope_as = agitator_party_scope	
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_liberal_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_liberal_ideology = yes
						}
					}
				}
			}	
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_liberal_ideology = yes
						}	
					}
				}
				save_scope_as = agitator_party_scope	
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_reactionary_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_reactionary_ideology = yes
						}
					}
				}
			}	
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_reactionary_ideology = yes
						}	
					}
				}
				save_scope_as = agitator_party_scope	
			}
		}
		else_if = {
			limit = {
				scope:agitator_scope = {
					has_conservative_ideology = yes
				}
				any_active_party = {
					any_member = {
						leader = {
							has_conservative_ideology = yes
						}
					}
				}
			}	
			random_active_party = {
				limit = {
					any_member = {
						leader = {
							has_conservative_ideology = yes
						}	
					}
				}
				save_scope_as = agitator_party_scope	
			}
		}
		else = {
			random_active_party = { #Chaos reigns
				save_scope_as = agitator_party_scope
			}
		}
	}
	remove_variable = preset_ideology
}

communist_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = communist_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_communist
				has_ideology = ideology:ideology_vanguardist
				has_ideology = ideology:ideology_anarchist
				AND = {
					this.interest_group = {
						is_member_of_party = owner.py:communist_party
					}
					NOT = {
						law_stance = {
							law = law_type:law_council_republic
							value < neutral
						}
					}
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

fascist_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = fascist_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_fascist
				has_ideology = ideology:ideology_integralist
				has_ideology = ideology:ideology_ethno_nationalist
				AND = {
					this.interest_group = {
						is_member_of_party = owner.py:fascist_party
					}
					NOT = {
						law_stance = {
							law = law_type:law_ethnostate
							value < neutral
						}
					}
				}
			}
			has_role = agitator
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

agrarian_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = agrarian_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_agrarian
				this.interest_group = {
					is_member_of_party = owner.py:agrarian_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

socdem_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = social_democrat_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_social_democrat
				this.interest_group = {
					is_member_of_party = owner.py:social_democrat_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

liberal_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = liberal_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_reformer
				has_ideology = ideology:ideology_humanitarian	
				has_ideology = ideology:ideology_humanitarian_royalist
				has_ideology = ideology:ideology_market_liberal
				this.interest_group = {
					is_member_of_party = owner.py:liberal_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

conservative_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = conservative_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			NOT = {
				has_ideology = ideology:ideology_abolitionist
			}
			OR = {
				has_ideology = ideology:ideology_matriarchal_traditionalist
                has_ideology = ideology:ideology_traditionalist
                has_ideology = ideology:ideology_ecumenical_traditionalist
				has_ideology = ideology:ideology_slaver
				this.interest_group = {
					is_member_of_party = owner.py:conservative_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

radical_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = radical_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_radical
				this.interest_group = {
					is_member_of_party = owner.py:radical_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

free_trade_agitator_election_scope_effect = {
	random_active_party = {
		limit = {
			is_party_type = free_trade_party
		}
		save_scope_as = agitator_party_scope
	}
	random_scope_character = {
		limit = {
			OR = {
				has_ideology = ideology:ideology_market_liberal
				this.interest_group = {
					is_member_of_party = owner.py:free_trade_party
				}
			}
			has_role = agitator
			NOT = {
				has_variable = agitator_election_participation
			}
		}
		save_scope_as = agitator_scope
		save_scope_as = exile_scope
		this.interest_group = {
			save_scope_as = agitator_ig_scope
		}
		this.political_movement ?= {
			save_scope_as = agitator_movement_scope
		}
	}
}

enact_preferred_governance_principle = {
	random_interest_group = {
		limit = {
			is_in_government = yes
			is_strongest_ig_in_government = yes
		}
		save_scope_as = ruling_ig
	}
	if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_council_republic
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_council_republic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_monarchy
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_monarchy
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_parliamentary_republic
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_parliamentary_republic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_presidential_republic
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_presidential_republic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_theocracy
					value = strongly_approve
				}
			}
		}
		activate_law = law_type:law_theocracy
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_council_republic
					value = approve
				}
			}
		}
		activate_law = law_type:law_council_republic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_monarchy
					value = approve
				}
			}
		}
		activate_law = law_type:law_monarchy
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_parliamentary_republic
					value = approve
				}
			}
		}
		activate_law = law_type:law_parliamentary_republic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_presidential_republic
					value = approve
				}
			}
		}
		activate_law = law_type:law_presidential_republic
	}
	else_if = {
		limit = {
			scope:ruling_ig ?= {
				law_stance = {
					law = law_type:law_theocracy
					value = approve
				}
			}
		}
		activate_law = law_type:law_theocracy
	}
	else = {
		activate_law = law_type:law_presidential_republic
		if = {
			limit = {
				civil_war_origin_country ?= {
					has_law = law_type:law_monarchy
				}
			}
			set_variable = prov_gov_monarchy
		}
		else_if = {
			limit = {
				civil_war_origin_country ?= {
					has_law = law_type:law_theocracy
				}
			}
			set_variable = prov_gov_theocracy
		}
		else_if = {
			limit = {
				civil_war_origin_country ?= {
					has_law = law_type:law_council_republic
				}
			}
			set_variable = prov_gov_council_republic
		}
		set_variable = revolutionary_prov_gov_var
	}
}

enact_preferred_governance_principle_new = {
	random_interest_group = {
		limit = {
			is_in_government = yes
			is_strongest_ig_in_government = yes
		}
		save_scope_as = ruling_ig
	}
	random_law = {
		limit = {
			OR = {
				type = law_type:law_chiefdom
				type = law_type:law_monarchy
				type = law_type:law_presidential_republic
				type = law_type:law_parliamentary_republic
				type = law_type:law_theocracy
				type = law_type:law_council_republic
			}
			type = {
				save_temporary_scope_as = enacted_gov_pric
			}
			scope:ruling_ig = {
				law_stance = {
					law = scope:enacted_gov_pric
					value = strongly_approve
				}
			}
		}
		save_scope_as = preferred_gov_principles
	}
	if = {
		limit = {
			NOT = {
				exists = scope:preferred_gov_principles
			}
		}
		random_law = {
			limit = {
				OR = {
					type = law_type:law_chiefdom
					type = law_type:law_monarchy
					type = law_type:law_presidential_republic
					type = law_type:law_parliamentary_republic
					type = law_type:law_theocracy
					type = law_type:law_council_republic
				}
				type = {
					save_temporary_scope_as = enacted_gov_pric
				}
				scope:ruling_ig = {
					law_stance = {
						law = scope:enacted_gov_pric
						value = approve
					}
				}
			}
			save_scope_as = preferred_gov_principles
		}
	}
	if = {
		limit = {
			NOT = {
				exists = scope:preferred_gov_principles
			}
		}
		random_law = {
			limit = {
				OR = {
					type = law_type:law_chiefdom
					type = law_type:law_monarchy
					type = law_type:law_presidential_republic
					type = law_type:law_parliamentary_republic
					type = law_type:law_theocracy
					type = law_type:law_council_republic
				}	
				type = {
					save_temporary_scope_as = enacted_gov_pric
				}
				scope:ruling_ig = {
					law_stance = {
						law = scope:enacted_gov_pric
						value = neutral
					}
				}
			}
			save_scope_as = preferred_gov_principles
		}
	}
	activate_law = scope:preferred_gov_principles
}

exile_character_with_martyrdom = {
	save_scope_as = martyred_exile_scope
	if = {
		limit = {
			NOT = {
				has_modifier = modifier_political_martyr
			}
		}
		add_modifier = modifier_political_martyr
	}
	if = {
		limit = {
			owner ?= {
				NOT = {
					any_primary_culture = {
						this = scope:martyred_exile_scope.culture
					}
				}
			}
		}
		if = {
			limit = {
				any_country = {
					NOT = {
						this = scope:martyred_exile_scope.owner
					}
					any_primary_culture = {
						this = scope:martyred_exile_scope.culture
					}
				}
			}
			ordered_country = {
				limit = {
					NOT = {
						this = scope:martyred_exile_scope.owner
					}
					any_primary_culture = {
						this = scope:martyred_exile_scope.culture
					}
				}
				order_by = country_rank
				create_diplomatic_catalyst = {
					type = catalyst_exiled_culture_member
					target = scope:martyred_exile_scope.owner
				}
			}
		}
	}
	clean_up_exile_character_roles = yes
	if = {
		limit = { is_in_exile_pool = no }
		exile_character = yes
	}
}

### Communism

calculate_communism_progress = {
	# From Laws
	set_variable = { name = communism_progress_from_laws value = 0 }
	# Cops
	set_variable = { name = temp_policing_var_contribution value = institution:institution_police.investment }
	if = {
		limit = {
			has_law = law_type:law_no_police
		}
		change_variable = { name = temp_policing_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_local_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_dedicated_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_militarized_police
		}
		change_variable = { name = temp_policing_var_contribution multiply = -0.5 }
	}
	
	# Internal Affairs
	set_variable = { name = temp_ha_var_contribution value = institution:institution_home_affairs.investment }
	if = {
		limit = {
			has_law = law_type:law_no_home_affairs
		}
		change_variable = { name = temp_ha_var_contribution add = 0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_guaranteed_liberties
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.1 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_national_guard
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.3 }
	}
	else_if = {
		limit = {
			has_law = law_type:law_secret_police
		}
		change_variable = { name = temp_ha_var_contribution multiply = -0.5 }
	}
	if = {
		limit = {
			has_variable = temp_policing_var_contribution
		}
		change_variable = { name = communism_progress_from_laws add = var:temp_policing_var_contribution }
		remove_variable = temp_policing_var_contribution
	}
	if = {
		limit = {
			has_variable = temp_ha_var_contribution
		}
		change_variable = { name = communism_progress_from_laws add = var:temp_ha_var_contribution }
		remove_variable = temp_ha_var_contribution
	}
}

set_communism_vars = {
	set_variable = { name = communism_progress_from_laws value = 0 }
	set_variable = { name = communism_progress_var_add value = 0 }
}

clear_communism_vars = {
	remove_variable = communism_progress_from_laws
	remove_variable = communism_progress_var_add
}

restore_peruvian_constitution = {
	# Made by Hansi
	# the Constitution of 1834 was largely a hotfix of the Constitution of 1828 and was also swept aside with the Peru-Bolivian Confederation
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_presidential_republic
			}
		}
		activate_law = law_type:law_presidential_republic
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_state_religion
			}
		}
		activate_law = law_type:law_state_religion # Article 2 of the 1834 consitution: "[Peru's] Religion is Catholic, Apostolic, Roman, The Nation protects it by all means [...] and does not allow the exercise of any other."
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_census_voting
			}
		}
		activate_law = law_type:law_census_voting # Political rights for citizens had no land ownership requirement 
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_racial_segregation
			}
		}
		activate_law = law_type:law_racial_segregation
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_mercantilism
			}
		}
		activate_law = law_type:law_mercantilism
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_interventionism
			}
		}
		activate_law = law_type:law_interventionism
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_right_of_assembly
			}
		}
		activate_law = law_type:law_right_of_assembly # Article 147 of the 1834 constitution: "Everyone can communicate their thoughts [...] or publish them through the printing press without prior censorship; but under the responsibility determined by law."
	}
	if = {
		limit = {
			NOR = {
				has_law = law_type:law_legacy_slavery
				has_law = law_type:law_slavery_banned
			}
		}
		activate_law = law_type:law_legacy_slavery # Slavery was legal, but the slave trade was restricted
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_per_capita_based_taxation
			}
		}
		activate_law = law_type:law_per_capita_based_taxation
	}
}

# National Identity
calculate_national_identity_progress = {
	set_variable = { name = national_identity_progress_var_next value = 0 }
	set_variable = { name = national_identity_progress_from_igs value = 0 }

	# From Interest Groups
	every_interest_group = {
		limit = {
			OR = {
				OR = {
					has_ideology = ideology:ideology_patriotic
					has_ideology = ideology:ideology_patriotic_pb
				}
				has_ideology = ideology:ideology_liberal
				has_ideology = ideology:ideology_liberal_modern
			}
		}
		ROOT = {
			set_variable = { name = ig_weight value = prev.ig_clout }
		}
		if = {
			limit = {
				is_in_government = yes
			}
			ROOT = {
				change_variable = { name = ig_weight multiply = 3 }
			}
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_igs add = var:ig_weight }
		}
	}

	#Wars
	set_variable = { name = national_identity_progress_from_wars value = 0 }
	every_scope_war = {
		limit = {
			has_war_support = { target = root value > 50 }
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_wars add = 0.50 }
		}
	}
	every_scope_war = {
		limit = {
			has_war_support = { target = root value <= 50 }
			has_war_support = { target = root value > 25 }
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_wars add = 0.25 }
		}
	}
	every_scope_war = {
		limit = {
			has_war_support = { target = root value <= 25 }
			has_war_support = { target = root value > 0 }
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_wars add = 0.10 }
		}
	}

	#Buildings
	set_variable = { name = national_identity_progress_from_universities value = 0 }
	every_scope_building = {
		limit = {
			OR = {
				is_building_type = building_arts_academy
				is_building_type = building_university
				is_building_type = building_government_administration
			}
			occupancy >= 0.75
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_universities add = prev.level }
		}
	}
	change_variable = { name = national_identity_progress_from_universities divide = 25 }

	set_variable = { name = national_identity_progress_from_prestige value = 0 }

	#Prestige
	ROOT = {
		change_variable = { name = national_identity_progress_from_prestige add = root.prestige }
	}
	change_variable = { name = national_identity_progress_from_prestige divide = 100 }

	set_variable = { name = national_identity_progress_from_homelands value = 0 }

	#Homelands
	every_scope_state = {
		limit = {
			NOT = {
				is_homeland_of_country_cultures = ROOT
			}
		}
		ROOT = {
			change_variable = { name = national_identity_progress_from_homelands subtract = 0.25 }
		}
	}

	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_igs }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_wars }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_universities }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_prestige }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_from_homelands }
	change_variable = { name = national_identity_progress_var_next add = var:national_identity_progress_var_add }
}

add_national_identity_progress = {
	change_variable = { name = national_identity_progress_var add = var:national_identity_progress_var_next }
	clamp_variable = { name = national_identity_progress_var max = 100 min = 0 }
}

set_national_identity_vars = {
	set_variable = { name = national_identity_progress_from_igs value = 0 }
	set_variable = { name = national_identity_progress_from_wars value = 0 }
	set_variable = { name = national_identity_progress_from_universities value = 0 }
	set_variable = { name = national_identity_progress_from_prestige value = 0 }
	set_variable = { name = national_identity_progress_from_homelands value = 0 }
	set_variable = { name = national_identity_progress_var_add value = 0 }
	set_variable = { name = ig_weight value = 0 }
}

clear_national_identity_vars = {
	remove_variable = national_identity_progress_from_igs
	remove_variable = national_identity_progress_from_wars
	remove_variable = national_identity_progress_from_universities
	remove_variable = national_identity_progress_from_prestige
	remove_variable = national_identity_progress_from_homelands
	remove_variable = national_identity_progress_var_add
}

replicate_laws_from_root = {
	every_law = {
		limit = {
			ROOT = {
				has_law = PREV.type
			}
			PREV = {
				NOT = {
					has_law = PREV.type
				}
			}
		}
		PREV = {
			activate_law = PREV.type
		}
	}
}

replicate_laws_from_prev = {
	every_law = {
		limit = {
			PREV = {
				has_law = PREV.type
			}
			ROOT = {
				NOT = {
					has_law = PREV.type
				}
			}
		}
		ROOT = {
			activate_law = PREV.type
		}
	}
}

capitulate_to_revolution = {
	scope:ongoing_revolution_movement = { #Can't trigger if they want governance reforms anyway.
		this.most_desired_law ?= {
			save_scope_as = revolutionaries_law
		}
	}
	every_interest_group = {
		limit = {
			is_insurrectionary = yes
		}
		set_variable = { name = revolutionary_ig days = 7 }
	}
	ordered_interest_group = {
		limit = {
			is_insurrectionary = yes
		}
		order_by = ig_clout
		save_scope_as = revolution_leader_ig
	}
	activate_law = scope:revolutionaries_law
	
	every_interest_group = {
		limit = {
			has_variable = revolutionary_ig
		}
		owner = {
			add_loyalists = {
				value = 0.8
				interest_group = PREV
			}
		}
	}
	
	if = {
		limit = {
			country_has_voting_franchise = yes
		}
		call_election = {
			months = 6
		}
	}
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_monarchy
			}
		}
		hidden_effect = {
			scope:revolution_leader_ig = {
				leader = {
					set_character_as_ruler = yes
				}
			}
		}
	}
	
	every_interest_group = {
		limit = {
			is_in_government = yes
		}
		remove_ruling_interest_group = yes
		add_modifier = {
			name = modifier_revolution_defeated_light
			days = normal_modifier_time
			is_decaying = yes
		}
	}
	
	every_interest_group = {
		limit = {
			has_variable = revolutionary_ig
		}
		hidden_effect = {
			abandon_revolution = yes
		}
		add_modifier = {
			name = modifier_revolution_victorious_light
			days = normal_modifier_time
			is_decaying = yes
		}
		if = {
			limit = {
				is_insurrectionary = no
			}
			add_ruling_interest_group = yes
		}
	}
}

handle_revolutionary_sps = {
	set_only_legal_party_from_ig = ruler.interest_group
	
	custom_tooltip = {
		text = sps_government_reshuffle_tt
		every_interest_group = {
			limit = {
				is_in_government = yes
				NOT = { #Removes all IGs from government that aren't in your party
					has_party = yes
				}
			}
			remove_ruling_interest_group = yes
		}
		every_interest_group = {
			limit = { #Adds all IGs that are in your party to the government
				is_in_government = no
				has_party = yes
			}
			add_ruling_interest_group = yes
		}
	}
}

generate_pro_lobby_diplomatic_pact_opportunity = {
	random_list = {
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:relevant_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = trade_privilege
							source_country = root
							target_country = scope:relevant_country
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:relevant_country
						any_scope_article = {
							has_type = trade_privilege
						}
					}
				}
			}
			set_variable = pro_lobby_proposal_trade_agreement
		}
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:relevant_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = defensive_pact
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:relevant_country
						any_scope_article = {
							has_type = defensive_pact
						}
					}
				}
			}
			set_variable = pro_lobby_proposal_defensive_pact
		}
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:relevant_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = alliance
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:relevant_country
						any_scope_article = {
							has_type = alliance
						}
					}
				}
			}
			set_variable = pro_lobby_proposal_alliance
		}
		20 = {
			trigger = {
				OR = {
					can_create_treaty = {
						first_country = root
						second_country = scope:relevant_country
						is_draft = no
						binding_period = { years = 2 }
						articles_to_create = {
							{
								article = foreign_investment_rights
								source_country = root
								target_country = scope:relevant_country
							}
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:relevant_country
						any_scope_article = {
							has_type = foreign_investment_rights
						}
					}
				}
			}
			set_variable = pro_lobby_proposal_investment_agreement
		}
		20 = {
			trigger = {
				scope:relevant_country = {
					is_power_bloc_leader = yes
				}
				can_create_diplomatic_pact = { target = scope:relevant_country type = join_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:relevant_country
				}
			}
			set_variable = pro_lobby_proposal_power_bloc
		}
		20 = {
			trigger = {
				is_power_bloc_leader = yes
				can_create_diplomatic_pact = { target = scope:relevant_country type = invite_to_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:relevant_country
				}
			}
			set_variable = pro_lobby_proposal_power_bloc_invite
		}
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:relevant_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = military_assistance
							source_country = root
							target_country = scope:relevant_country
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:relevant_country
						any_scope_article = {
							has_type = military_assistance
							source_country = root
						}
					}
				}
			}
			set_variable = pro_lobby_proposal_military_assistance
		}
	}
}

generate_pro_lobby_diplomatic_pact_proposal = {
	random_list = {
		20 = { # Break an alliance
			trigger = {
				any_scope_treaty = {
					binding_period <= 0
					binds = scope:third_party_country
					any_scope_article = {
						has_type = alliance
					}
				}
			}
			set_variable = pro_lobby_proposal_break_alliance
		}
		20 = { # Break a trade agreement
			trigger = {
				any_scope_treaty = {
					binding_period <= 0
					binds = scope:third_party_country
					any_scope_article = {
						has_type = trade_privilege
					}
				}
			}
			set_variable = pro_lobby_proposal_break_trade_agreement
		}
		20 = { # Break a defensive pact
			trigger = {
				any_scope_treaty = {
					binding_period <= 0
					binds = scope:third_party_country
					any_scope_article = {
						has_type = defensive_pact
					}
				}
			}
			set_variable = pro_lobby_proposal_break_defensive_pact
		}
		20 = { # Do a rivalry
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = rivalry }
			}
			set_variable = pro_lobby_proposal_rivalry
		}
		20 = { # Do an embargo
			trigger = {
				can_create_diplomatic_pact = { target = scope:third_party_country type = embargo }
			}
			set_variable = pro_lobby_proposal_embargo
		}
		20 = { # Do a war
			trigger = {
				pro_lobby_war_valid_check = yes
			}
			set_variable = pro_lobby_proposal_war
		}
		20 = { # Leave Power Bloc
			trigger = {
				pro_lobby_leave_power_bloc_valid_check = yes
			}
			set_variable = pro_lobby_proposal_leave_power_bloc
		}
	}
}

generate_anti_lobby_diplomatic_pact_opportunity = {
	random_list = {
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:third_party_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = trade_privilege
							source_country = root
							target_country = scope:third_party_country
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:third_party_country
						any_scope_article = {
							has_type = trade_privilege
						}
					}
				}
			}
			set_variable = anti_lobby_proposal_trade_agreement
		}
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:third_party_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = defensive_pact
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:third_party_country
						any_scope_article = {
							has_type = defensive_pact
						}
					}
				}
			}
			set_variable = anti_lobby_proposal_defensive_pact
		}
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:third_party_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = alliance
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:third_party_country
						any_scope_article = {
							has_type = alliance
						}
					}
				}
			}
			set_variable = anti_lobby_proposal_alliance
		}
		20 = {
			trigger = {
				OR = {
					can_create_treaty = {
						first_country = root
						second_country = scope:third_party_country
						is_draft = no
						binding_period = { years = 2 }
						articles_to_create = {
							{
								article = foreign_investment_rights
								source_country = root
								target_country = scope:third_party_country
							}
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:third_party_country
						any_scope_article = {
							has_type = foreign_investment_rights
						}
					}

				}
			}
			set_variable = anti_lobby_proposal_investment_agreement
		}
		20 = {
			trigger = {
				scope:third_party_country = {
					is_power_bloc_leader = yes
				}
				can_create_diplomatic_pact = { target = scope:third_party_country type = join_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:third_party_country
				}
			}
			set_variable = anti_lobby_proposal_power_bloc
		}
		20 = {
			trigger = {
				is_power_bloc_leader = yes
				can_create_diplomatic_pact = { target = scope:third_party_country type = invite_to_power_bloc }
				NOT = {
					is_in_same_power_bloc = scope:third_party_country
				}
			}
			set_variable = anti_lobby_proposal_power_bloc_invite
		}
		20 = {
			trigger = {
				can_create_treaty = {
					first_country = root
					second_country = scope:third_party_country
					is_draft = no
					binding_period = { years = 2 }
					articles_to_create = {
						{
							article = military_assistance
							source_country = root
							target_country = scope:third_party_country
						}
					}
				}
				NOT = {
					any_scope_treaty = {
						binds = scope:third_party_country
						any_scope_article = {
							has_type = military_assistance
							source_country = root
						}
					}
				}
			}
			set_variable = anti_lobby_proposal_military_assistance
		}
	}
}

generate_anti_lobby_diplomatic_pact_proposal = {
	random_list = {
		20 = { # Break an alliance
			trigger = {
				any_scope_treaty = {
					binding_period <= 0
					binds = scope:relevant_country
					any_scope_article = {
						has_type = alliance
					}
				}
			}
			set_variable = anti_lobby_proposal_break_alliance
		}
		20 = { # Break a trade agreement
			trigger = {
				any_scope_treaty = {
					binding_period <= 0
					binds = scope:relevant_country
					any_scope_article = {
						has_type = trade_privilege
					}
				}
			}
			set_variable = anti_lobby_proposal_break_trade_agreement
		}
		20 = { # Break a defensive pact
			trigger = {
				any_scope_treaty = {
					binding_period <= 0
					binds = scope:relevant_country
					any_scope_article = {
						has_type = defensive_pact
					}
				}
			}
			set_variable = anti_lobby_proposal_break_defensive_pact
		}
		20 = { # Do a rivalry
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = rivalry }
			}
			set_variable = anti_lobby_proposal_rivalry
		}
		20 = { # Do an embargo
			trigger = {
				can_create_diplomatic_pact = { target = scope:relevant_country type = embargo }
			}
			set_variable = anti_lobby_proposal_embargo
		}
		20 = { # Do a war
			trigger = {
				anti_lobby_war_valid_check = yes
			}
			set_variable = anti_lobby_proposal_war
		}
		20 = { # Leave Power Bloc
			trigger = {
				anti_lobby_leave_power_bloc_valid_check = yes
			}
			set_variable = anti_lobby_proposal_leave_power_bloc
		}
	}
}

clear_anti_lobby_vars = {
	remove_variable = anti_lobby_proposal_break_alliance
	remove_variable = anti_lobby_proposal_break_trade_agreement
	remove_variable = anti_lobby_proposal_break_defensive_pact
	remove_variable = anti_lobby_proposal_rivalry
	remove_variable = anti_lobby_proposal_embargo
	remove_variable = anti_lobby_proposal_war
	remove_variable = anti_lobby_proposal_leave_power_bloc
	remove_variable = anti_lobby_proposal_defensive_pact
	remove_variable = anti_lobby_proposal_military_assistance
	remove_variable = anti_lobby_proposal_alliance
	remove_variable = anti_lobby_proposal_trade_agreement
	remove_variable = anti_lobby_proposal_power_bloc
	remove_variable = anti_lobby_proposal_power_bloc_invite
	remove_variable = anti_lobby_proposal_investment_agreement
	remove_variable = anti_lobby_opportunity_target
	remove_variable = anti_lobby_demand_target
}

clear_pro_lobby_vars = {
	remove_variable = pro_lobby_proposal_defensive_pact
	remove_variable = pro_lobby_proposal_alliance
	remove_variable = pro_lobby_proposal_trade_agreement
	remove_variable = pro_lobby_proposal_power_bloc
	remove_variable = pro_lobby_proposal_power_bloc_invite
	remove_variable = pro_lobby_proposal_military_assistance
	remove_variable = pro_lobby_proposal_investment_agreement
	remove_variable = pro_lobby_proposal_break_alliance
	remove_variable = pro_lobby_proposal_break_trade_agreement
	remove_variable = pro_lobby_proposal_break_defensive_pact
	remove_variable = pro_lobby_proposal_rivalry
	remove_variable = pro_lobby_proposal_embargo
	remove_variable = pro_lobby_proposal_war
	remove_variable = pro_lobby_proposal_leave_power_bloc
	remove_variable = pro_lobby_demand_target
	remove_variable = pro_lobby_opportunity_target
}

character_traditionalist_switch_effect = {
	if = {
		limit = {
			NOT = {
				religion = owner.religion
			}
			OR = {
				has_ideology = ideology:ideology_matriarchal_traditionalist
                has_ideology = ideology:ideology_traditionalist
                has_ideology = ideology:ideology_ecumenical_traditionalist
			}
		}
		if = {
			limit = {
				has_ideology = ideology:ideology_matriarchal_traditionalist
			}
			set_ideology = ideology:ideology_matriarchal_minoritarian
		}
		else = {
			set_ideology = ideology:ideology_traditionalist_minoritarian
		}
		
	}
	if = {
		limit = {
			religion = owner.religion
			has_ideology = ideology:ideology_traditionalist_minoritarian
		}
		if = {
				limit = {
					owner.religion = {
						has_discrimination_trait = uriks_pantheon
					}
				}
			set_ideology = ideology:ideology_ecumenical_traditionalist
		}
		else = {
			set_ideology = ideology:ideology_traditionalist
		}
	}
	if = {
		limit = {
			religion = owner.religion
			has_ideology = ideology:ideology_matriachal_minoritarian
		}
		set_ideology = ideology:ideology_matriarchal_traditionalist
	}
}

state_religion_switch_effect = {
	if = {
		limit = {
			NOT = {
				has_law = law_type:law_state_atheism
			}
		}
		every_scope_character = {
			limit = {
				NOT = {
					religion = owner.religion
				}
				has_ideology = ideology:ideology_traditionalist
			}
			set_ideology = ideology:ideology_traditionalist_minoritarian
		}
		every_scope_character = {
			limit = {
				religion = owner.religion
				has_ideology = ideology:ideology_traditionalist_minoritarian
			}
			set_ideology = ideology:ideology_traditionalist
		}
	}
}

free_from_exile_effect = {
	remove_modifier = in_exile_modifier
	character_traditionalist_switch_effect = yes
}